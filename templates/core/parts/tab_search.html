<section id="tab-search" class="tab-section px-4 py-4 hidden">
  <h2 class="text-base font-bold tracking-tight">検索</h2>

  <form class="mt-3 grid gap-3" method="get" action="/">
    <input type="hidden" name="tab" value="search"/>

    <div class="relative">
      <input
        name="q"
        value="{{ search_query }}"
        class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-input-dark px-4 py-3 pl-11 text-base text-slate-900 dark:text-white placeholder:text-slate-400 focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none"
        placeholder="タイトル / サークル名 / 場所で検索"
        type="text"
      />
      <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
        <span class="material-symbols-outlined" style="font-size:22px;">search</span>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-2">
      <select name="category" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-input-dark px-3 py-3 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none">
        <option value="">カテゴリ（全て）</option>
        {% for val,label in category_choices %}
          <option value="{{ val }}" {% if category == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>

      <select name="tag" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-input-dark px-3 py-3 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none">
        <option value="">タグ（全て）</option>
        {% for t in tags %}
          <option value="{{ t.name }}" {% if tag == t.name %}selected{% endif %}>{{ t.name }}</option>
        {% endfor %}
      </select>
    </div>

    <label class="inline-flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
      <input type="checkbox" name="open" value="1" {% if only_open %}checked{% endif %}
        class="rounded border-slate-300 dark:border-slate-700 text-primary focus:ring-primary" />
      募集中のみ（終了は除外）
    </label>

    <button type="submit" class="w-full rounded-xl bg-primary hover:bg-cyan-400 text-background-dark font-bold text-base h-12 shadow-lg shadow-primary/25 transition-all active:scale-[0.98]">
      検索する
    </button>
  </form>

  <div class="mt-5 grid gap-3">
    {% for p in search_results %}
      <article class="rounded-2xl bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-800 overflow-hidden">
        <button type="button" class="w-full block" onclick="openPostModal({{ p.id }})">
          {% if p.image %}
            <img class="w-full h-36 object-cover" src="{{ p.image.url }}" alt="post image">
          {% else %}
            <div class="w-full h-28 bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
              <span class="text-slate-400 text-sm">画像なし（タップで詳細）</span>
            </div>
          {% endif %}
        </button>

        <div class="p-4">
          <div class="flex items-start justify-between gap-2">
            <div class="text-sm font-bold">{{ p.title }}</div>
            {% if p.effective_status == "closed" %}
              <span class="shrink-0 inline-flex items-center px-2 py-1 rounded-full text-[11px] font-bold bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300">終了</span>
            {% else %}
              <span class="shrink-0 inline-flex items-center px-2 py-1 rounded-full text-[11px] font-bold bg-primary/15 text-primary">募集中</span>
            {% endif %}
          </div>

          <div class="mt-2 text-xs text-slate-500 dark:text-slate-400">
            {{ p.circle_name|default:"（サークル名未設定）" }} ・ {{ p.event_at|date:"m/d H:i" }} ・ {{ p.place|default:"（場所未設定）" }}
          </div>
        </div>
      </article>
    {% empty %}
      <div class="rounded-2xl border border-slate-200 dark:border-slate-800 p-6 text-center text-slate-500 dark:text-slate-400 bg-white dark:bg-surface-dark">
        該当する投稿がありません。
      </div>
    {% endfor %}
  </div>
</section>
